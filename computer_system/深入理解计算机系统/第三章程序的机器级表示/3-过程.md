## 对抗缓冲区溢出攻击

### 栈随机化
* 栈随机化的思想是使栈的位置在程序每次运行时都有变化。
* 实现原理：
    * 程序开始时，在栈上分配0-n字节之间的随机大小的空间，程序不使用这段空间，但是它会导致程序每次执行时，后续的栈位置发生变化。
    * 分配的范围n必须足够大，才能获得足够多的栈地址变化，又要足够小，不至于浪费程序太多的空间。
* Linux中该类技术成为标准，称为地址空间布局随机化(Address-Space Layout Randomization, ASLR)，每次运行时，程序代码/库代码/栈/全局变量/堆数据都会被加载到内存的不同区域。

### 栈破坏检测
* 栈保护(stack protector)机制，其思想是在栈帧中任何局部缓冲区与栈状态之间存储一个特殊的金丝雀(canary)值。
* 金丝雀值是运行时随机产生的，当恢复寄存器状态和从函数返回前，检查金丝雀值是否被改变。
* gcc中编译选项-fstack-protector会在相应位置产生金丝雀检查代码，如果检查失败，会执行__stack_chk_fail

### 限制可执行代码区域
* 通过限制内存区域的可执行权限，可以消除攻击者在内存区域插入可执行代码的能力。